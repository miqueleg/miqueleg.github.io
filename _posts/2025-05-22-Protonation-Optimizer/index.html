<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Protonation Optimizer | Dr. Miquel Estévez-Gay - Protein Engineering </title> <meta name="author" content="Miquel Estévez-Gay"> <meta name="description" content="Announcement of 200~Protonation Optimizer"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website, Bioinformatics, Enzyme-Design, Protein, Simulations"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://miqueleg.github.io/_posts/2025-05-22-Protonation-Optimizer/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Dr. Miquel Estévez-Gay - Protein Engineering </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Protonation Optimizer</h1> <p class="post-meta"> Created on May 22, 2025 </p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2025   ·   <i class="fa-solid fa-hashtag fa-sm"></i> script python protonation </p> </header> <article class="post-content"> <div id="markdown-content"> <p>I’m excited to share my latest computational tool for the molecular modeling community: Protonation Optimizer - a (SemiEmpirical) quantum mechanics-based solution for determining optimal amino acid protonation states in protein structures!</p> <p>🔬 Why it matters: Accurate protonation states are critical for reliable molecular dynamics (MD) simulations, yet they’re often overlooked. Incorrect assignments can lead to artifacts or misleading results, particularly with histidine residues that can exist in multiple tautomeric forms for the same pH conditions.</p> <h4 id="-key-features">⚡ Key features:</h4> <p>Integrates PropKa3 for pKa predictions and initial state assignments. Employs xTB semi-empirical quantum chemistry calculations to determine energetically favorable protonation states. Handles both HID (δ-protonated) and HIE (ε-protonated) histidine tautomers with QM accuracy. Provides detailed energy reports and automatically generates optimized PDB files.</p> <h3 id="-check-it-out-protonation-optimizer">🔗 Check it out: <a href="https://github.com/miqueleg/protonation-optimizer/tree/main" title="Protonation State Optimizer" rel="external nofollow noopener" target="_blank">Protonation-Optimizer</a> </h3> <p>Feel free to use it and let me know how it went!</p> <h1 id="protonation-state-optimizer">Protonation State Optimizer</h1> <p>A quantum mechanics-based tool for determining optimal aminoacidic protonation states (focusing on Histidines) in protein structures for molecular dynamics simulations.</p> <h2 id="description">Description</h2> <p>This tool analyzes protein structures and determines the energetically favorable protonation state for each histidine residue using the xTB semi-empirical quantum chemistry method (HID/HIE). It accurately handles the two neutral tautomeric forms of histidine by:</p> <ol> <li>Checks pKa using the PropKa3 tool. It determines HIP protonation based on pKa</li> <li>Extracting the local environment around each histidine residue</li> <li>Generating both HID (delta-protonated) and HIE (epsilon-protonated) tautomers</li> <li>Special handling of charged residues (ASP, GLU, LYS, ARG) with proper proton positioning</li> <li>Running quantum mechanical energy calculations on each tautomer</li> <li>Comparing energies to determine the optimal protonation state</li> </ol> <p>This tool is particularly useful for preparing protein structures for molecular dynamics simulations where histidine protonation can significantly impact results.</p> <h2 id="dependencies">Dependencies</h2> <h3 id="python-packages">Python Packages</h3> <ul> <li>NumPy</li> <li>Pandas</li> <li>MDTraj</li> <li>BioPython (Bio.PDB)</li> <li>Tabulate</li> </ul> <h3 id="external-software">External Software</h3> <ul> <li>Open Babel (for hydrogen placement)</li> <li>xTB (for quantum mechanical calculations)</li> <li>PropKa3</li> </ul> <h2 id="installation">Installation</h2> <ol> <li> <p>Install the required Python packages:</p> </li> <li> <p>Install Open Babel:</p> </li> <li> <p>Install xTB:</p> </li> <li> <p>Install PropKa3</p> </li> <li> <p>Clone the repository:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>git clone https://github.com/miqueleg/protonation-optimizer
</code></pre></div> </div> </li> </ol> <h2 id="usage">Usage</h2> <p>Basic usage:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python protonation_optimizer.py input.pdb output.pdb
</code></pre></div></div> <p>With custom environment cutoff (default is 5.0 Å):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python protonation_optimizer.py input.pdb output.pdb --cutoff 6.0
</code></pre></div></div> <p>Changing Optimization level and Solvent (default loose and ether) :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python protonation_optimizer.py input.pdb output.pdb --xtbopt crude --solvent water
</code></pre></div></div> <p>Using Single Point calculations instead of Optimization [Faster but less precise] (default opt) :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python protonation_optimizer.py input.pdb output.pdb --mode SP
</code></pre></div></div> <p>This will:</p> <ol> <li>Run PropKa3 and determine initial protonations</li> <li>Find all histidine residues in <code class="language-plaintext highlighter-rouge">protein.pdb</code> </li> <li>For each histidine, extract a 5.0 Å environment</li> <li>Create both HID and HIE tautomers with proper hydrogen placement</li> <li>Run xTB optimization or single point calculations on each tautomer</li> <li>Determine the optimal protonation state based on energy</li> <li>Generate a detailed report table of the analysis</li> </ol> <h2 id="output-files">Output Files</h2> <p>The tool generates several outputs:</p> <ul> <li>An optimized PDB file with the computed protonation states of the AminoAcids in your protein</li> <li>A CSV file with energy results for each histidine</li> <li>A detailed text report of the analysis</li> <li>xTB log files for each calculation in an <code class="language-plaintext highlighter-rouge">xtb_logs</code> directory</li> </ul> <h2 id="special-features">Special Features</h2> <ul> <li> <strong>Charged Residue Handling</strong>: It handles ASP, GLU, LYS, and ARG by pKa/pH comparison using PropKa3</li> <li> <strong>Constraint-based Optimization</strong>: Allows hydrogen atoms to relax during energy calculations while keeping heavy atoms fixed</li> </ul> <h2 id="limitations">Limitations</h2> <ul> <li>Only handles the two neutral tautomers via QM (HID and HIE), not the protonated form (HIP). The latest is only determined via pKa calculation</li> <li>Processes each histidine independently; for histidines in close proximity, results may not capture cooperative effects (yet)</li> </ul> <h2 id="citing-this-software">Citing This Software</h2> <p>If you use this tool in your research, please cite it as:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Estévez-Gay, M. (2025). Protonation State Optimizer.
GitHub repository: https://github.com/miqueleg/protonation-optimizer
</code></pre></div></div> </div> </article> <p class="mb-2" style="margin-top: 1.5rem !important">Subscribe to be notified of future articles:</p> <div class="newsletter-form-container"> <form class="newsletter-form" action="https://app.loops.so/api/newsletter-form/" method="POST" style="justify-content: flex-start"> <input class="newsletter-form-input" name="newsletter-form-input" type="email" placeholder="user@example.com" required=""> <button type="submit" class="newsletter-form-button" style="justify-content: flex-start"> subscribe </button> <button type="button" class="newsletter-loading-button" style="justify-content: flex-start"> Please wait... </button> </form> <div class="newsletter-success" style="justify-content: flex-start"> <p class="newsletter-success-message">You're subscribed!</p> </div> <div class="newsletter-error" style="justify-content: flex-start"> <p class="newsletter-error-message">Oops! Something went wrong, please try again</p> </div> <button class="newsletter-back-button" type="button" onmouseout='this.style.textDecoration="none"' onmouseover='this.style.textDecoration="underline"'> ← Back </button> </div> <noscript> <style>.newsletter-form-container{display:none}</style> </noscript> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Miquel Estévez-Gay. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: May 24, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> <script defer src="/assets/js/newsletter.js?c3d0931971ee96e9df74ba70526c3130"></script> </body> </html>